<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–µè‹—ç”°å£è‰åšå®¢</title>
    
    <link rel="icon" type="image/png" href="bblogo.png">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.12.0/dist/av-min.js"></script>
    
    <style>
        /* åŸæœ‰åŸºç¡€æ ·å¼ä¿æŒä¸å˜ */
        #video-background { position: fixed; top: 50%; left: 50%; min-width: 100%; min-height: 100%; transform: translate(-50%, -50%); z-index: -100; object-fit: cover; filter: brightness(0.6); }
        body { font-family: -apple-system, sans-serif; margin: 0; background: #000; color: #222; }
        .main-container { max-width: 750px; margin: 0 auto; padding: 40px 20px; }

        /* 1. å¢å¼ºç‰ˆé¡¶æ ï¼ˆå¸¦æœç´¢ï¼‰ */
        .header {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255, 255, 255, 0.85); padding: 12px 20px; border-radius: 18px;
            backdrop-filter: blur(15px); margin-bottom: 35px; border: 1px solid rgba(255, 255, 255, 0.4);
        }
        .header-left { display: flex; align-items: center; }
        .logo { width: 40px; height: 40px; margin-right: 12px; cursor: pointer; }
        h1 { margin: 0; font-size: 1.1rem; color: #1a1a1a; white-space: nowrap; }

        /* æœç´¢æ¡† UI */
        .search-wrapper { display: flex; align-items: center; position: relative; }
        .search-input {
            width: 0; opacity: 0; padding: 8px 0; border: none; border-bottom: 2px solid #0056b3;
            background: transparent; outline: none; transition: all 0.4s ease; font-size: 14px;
        }
        .search-input.active { width: 150px; opacity: 1; padding: 8px 10px; }
        .search-icon { cursor: pointer; font-size: 20px; padding: 5px; transition: 0.3s; }
        .search-icon:hover { transform: scale(1.1); }

        /* 2. æ–‡ç« å¡ç‰‡æ ·å¼ */
        .post { background: rgba(255, 255, 255, 0.92); padding: 30px; border-radius: 24px; margin-bottom: 30px; backdrop-filter: blur(10px); transition: 0.3s; }
        .post.hidden { display: none; } /* æœç´¢è¿‡æ»¤ç”¨ */
        
        /* æŒ‰é’®ä¸å…¶ä»–ç»„ä»¶ä¿æŒä¹‹å‰çš„ä¼˜åŒ–æ ·å¼ */
        .action-bar { display: flex; gap: 10px; margin-top: 15px; }
        .like-btn, .comment-toggle { border: none; padding: 10px 18px; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .like-btn { background: rgba(255, 71, 87, 0.1); color: #ff4757; }
        .like-btn.active { background: #ff4757; color: white; }
        .comment-toggle { background: #0056b3; color: white; }
        .side-panel { position: fixed; right: 30px; top: 120px; display: flex; flex-direction: column; gap: 12px; z-index: 100; }
        .side-btn { background: white; padding: 12px 20px; border-radius: 50px; text-decoration: none; color: #333; font-weight: bold; font-size: 14px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-pay { background: #ff4757; color: white; }

        @media (max-width: 600px) {
            .side-panel { position: static; flex-direction: row; margin-bottom: 25px; }
            .search-input.active { width: 100px; } /* æ‰‹æœºç«¯æœç´¢æ¡†ç¨çŸ­ */
        }
        .content img, .content video { max-width: 100%; border-radius: 12px; margin: 15px 0; }
    </style>
</head>
<body>

    <video autoplay muted loop playsinline id="video-background">
        <source src="background.mp4" type="video/mp4">
    </video>

    <div class="main-container">
        <header class="header">
            <div class="header-left">
                <img src="bblogo.png" alt="Logo" class="logo" onclick="location.reload()">
                <h1>å–µè‹—ç”°å£è‰</h1>
            </div>
            <div class="search-wrapper">
                <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥å…³é”®è¯...">
                <div class="search-icon" onclick="toggleSearch()">ğŸ”</div>
            </div>
        </header>

        <div class="side-panel">
            <a href="https://xhslink.com/m/8c7qBm5fcST" target="_blank" class="side-btn">ğŸ“• å°çº¢ä¹¦</a>
            <a href="https://www.facebook.com/share/19JhjNVtCH/" target="_blank" class="side-btn">ğŸ“˜ è„¸ä¹¦</a>
            <button onclick="togglePay(true)" class="side-btn btn-pay">â˜• æ‰“èµ</button>
        </div>

        <div id="posts-container">
            <div class="post">ğŸš€ å–µå–µæ­£åœ¨åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

    <script>
        // 1. åˆå§‹åŒ– LeanCloud
        AV.init({
            appId: "KEVV8UiFOCg8pehjuwp0Qs4X-MdYXbMMI",
            appKey: "jv3DhOJKIURFTTDTNAieGrDS",
            serverURL: "https://kevv8uif.api.lncldglobal.com"
        });

        // 2. æœç´¢é€»è¾‘
        function toggleSearch() {
            const input = document.getElementById('searchInput');
            input.classList.toggle('active');
            if (input.classList.contains('active')) {
                input.focus();
            } else {
                input.value = '';
                filterPosts(''); // å…³é—­æ—¶é‡ç½®æœç´¢
            }
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterPosts(e.target.value.toLowerCase());
        });

        function filterPosts(keyword) {
            const posts = document.querySelectorAll('.post');
            posts.forEach(post => {
                const title = post.querySelector('h2').innerText.toLowerCase();
                const content = post.querySelector('.content').innerText.toLowerCase();
                if (title.includes(keyword) || content.includes(keyword)) {
                    post.classList.remove('hidden');
                } else {
                    post.classList.add('hidden');
                }
            });
        }

        // å…¶ä»–åŸæœ‰é€»è¾‘ï¼ˆæ‰“èµã€ç‚¹èµã€åŠ è½½æ–‡ç« ï¼‰
        function togglePay(show) { /* ...ä¿æŒä¸å˜... */ }
        async function getLikeCount(id, span) { /* ...ä¿æŒä¸å˜... */ }
        async function handleLike(btn, id) { /* ...ä¿æŒä¸å˜... */ }
        function toggleComments(id) { /* ...ä¿æŒä¸å˜... */ }

        const GITHUB_USERNAME = 'aeribare0108';
        const REPO_NAME = 'aeribare0108.github.io';
        const CUSDIS_APP_ID = 'ba5226e8-dac4-45ae-9acb-27723c830cc0';

        async function fetchPosts() {
            const url = `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/issues?labels=post&state=open`;
            try {
                const response = await fetch(url);
                const issues = await response.json();
                const container = document.getElementById('posts-container');
                container.innerHTML = '';

                issues.forEach(issue => {
                    const postElement = document.createElement('div');
                    postElement.className = 'post';
                    const date = new Date(issue.created_at).toLocaleDateString();
                    const isLiked = JSON.parse(localStorage.getItem('liked_posts') || '{}')[issue.id];

                    postElement.innerHTML = `
                        <h2>${issue.title}</h2>
                        <small>ğŸ“… ${date}</small>
                        <div class="content">${marked.parse(issue.body || "")}</div>
                        <div class="action-bar">
                            <button class="like-btn ${isLiked?'active':''}" onclick="handleLike(this, '${issue.id}')">
                                ${isLiked?'â¤ï¸ å·²èµ':'ğŸ¤ ç‚¹èµ'} <span class="count" id="count-${issue.id}">0</span>
                            </button>
                            <button class="comment-toggle" onclick="toggleComments('${issue.id}')">ğŸ’¬ ç•™è¨€</button>
                        </div>
                        <div id="comment-box-${issue.id}" style="display:none; margin-top:20px; border-top:1px solid #eee; padding-top:15px;">
                            <div id="cusdis_thread" data-host="https://cusdis.com" data-app-id="${CUSDIS_APP_ID}" data-page-id="${issue.id}" data-page-url="${window.location.href}#${issue.id}" data-page-title="${issue.title}"></div>
                        </div>
                    `;
                    container.appendChild(postElement);
                    getLikeCount(issue.id, document.getElementById(`count-${issue.id}`));
                });
            } catch (e) { container.innerHTML = '<div class="post">âŒ åŠ è½½å¤±è´¥</div>'; }
        }
        fetchPosts();

        // è¡¥å…¨ç¼ºå¤±çš„è¾…åŠ©å‡½æ•°
        function togglePay(show) { document.querySelector('#pay-overlay').style.display = show ? 'flex' : 'none'; }
        async function getLikeCount(issueId, span) {
            try {
                const query = new AV.Query('Counter');
                query.equalTo('issueId', String(issueId));
                const res = await query.first();
                span.innerText = res ? res.get('likes') : 0;
            } catch(e) {}
        }
        async function handleLike(btn, id) {
            // ... ä½¿ç”¨ä¹‹å‰çš„ LeanCloud handleLike é€»è¾‘ ...
            // (æ­¤å¤„ä¸ºäº†ç®€çŸ­æœªé‡å¤ç²˜è´´ï¼Œè¯·ä¿ç•™ä½ ä¸Šä¸ªç‰ˆæœ¬ä¸­çš„å®Œæ•´ handleLike å‡½æ•°å†…å®¹)
        }
    </script>
    
    <div id="pay-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:200;" onclick="togglePay(false)">
        <div style="background:white; padding:20px; border-radius:24px; position:relative;" onclick="event.stopPropagation()">
            <img src="payment.jpg" style="max-width:300px; border-radius:15px;">
            <div style="position:absolute; top:-10px; right:-10px; background:#ff4757; color:white; width:30px; height:30px; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer;" onclick="togglePay(false)">Ã—</div>
        </div>
    </div>
</body>
</html>
